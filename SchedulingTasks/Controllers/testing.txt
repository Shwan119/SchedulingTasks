$(document).ready(function() {
    // Handle filter checkbox changes
    $('#showAll, #filterActive, #filterPending, #filterRetired').on('change', function() {
        const $this = $(this);
        const thisId = $this.attr('id');

        // If "Show All" was just checked
        if (thisId === 'showAll') {
            if ($this.prop('checked')) {
                // Uncheck all specific filters when "Show All" is checked
                $('#filterActive, #filterPending, #filterRetired').prop('checked', false);
            } else {
                // If "Show All" was unchecked but no specific filters are checked,
                // keep "Show All" checked
                if (!$('#filterActive').prop('checked') && 
                    !$('#filterPending').prop('checked') && 
                    !$('#filterRetired').prop('checked')) {
                    $('#showAll').prop('checked', true);
                    return; // Exit early to prevent infinite loop
                }
            }
        } else {
            // A specific filter was clicked
            if ($this.prop('checked')) {
                // If any specific filter is checked, uncheck "Show All"
                $('#showAll').prop('checked', false);
            } else {
                // If this specific filter was unchecked, check if any other specific filters are still checked
                if (!$('#filterActive').prop('checked') && 
                    !$('#filterPending').prop('checked') && 
                    !$('#filterRetired').prop('checked')) {
                    // If no specific filters are checked, check "Show All"
                    $('#showAll').prop('checked', true);
                }
            }
        }

        // Now apply the filtering
        applyFilters();
    });

    // Add search field event handler
    $('#searchAllFields').on('keyup', function() {
        applyFilters();
    });

    function applyFilters() {
        const showAll = $('#showAll').prop('checked');
        const showActive = $('#filterActive').prop('checked');
        const showPending = $('#filterPending').prop('checked');
        const showRetired = $('#filterRetired').prop('checked');
        const searchTerm = $('#searchAllFields').val().toLowerCase();

        // First handle visibility based on status filters
        if (showAll) {
            // Show all rows
            $('#reportsTable tbody tr').show();
        } else {
            // Hide all rows first
            $('#reportsTable tbody tr').hide();

            // Show rows based on selected filters
            if (showActive) {
                $('#reportsTable tbody tr[data-status="Active"]').show();
            }

            if (showPending) {
                $('#reportsTable tbody tr[data-status="Pending"]').show();
            }

            if (showRetired) {
                $('#reportsTable tbody tr[data-status="Retired"]').show();
            }
        }

        // Then filter by search term if one exists
        if (searchTerm) {
            $('#reportsTable tbody tr:visible').each(function() {
                const $row = $(this);
                const rowText = $row.text().toLowerCase();
                
                if (!rowText.includes(searchTerm)) {
                    $row.hide();
                }
            });
        }
        
        // Update the counter
        updateCounter();
    }
    
    function updateCounter() {
        const totalRows = $('#reportsTable tbody tr').length;
        const visibleRows = $('#reportsTable tbody tr:visible').length;
        
        $('#reportCounter').text(`Showing ${visibleRows} of ${totalRows} reports`);
    }

    // Initialize filtering on page load
    applyFilters();
});


@* In your Razor View *@
<div class="filter-controls mb-4">
    <div class="d-flex align-items-center flex-wrap mb-3">
        <div class="mr-4">
            <span class="font-medium mr-2">Filter by Status:</span>
            <label class="mr-2">
                <input type="checkbox" id="showAll" checked /> Show All
            </label>
            <label class="mr-2">
                <input type="checkbox" id="filterActive" /> Active
            </label>
            <label class="mr-2">
                <input type="checkbox" id="filterPending" /> Pending
            </label>
            <label>
                <input type="checkbox" id="filterRetired" /> Retired
            </label>
        </div>
        
        <div>
            <span class="font-medium mr-2">Search All Fields:</span>
            <input 
                type="text" 
                id="searchAllFields" 
                placeholder="Search reports..." 
                class="form-control d-inline-block" 
                style="width: 250px;"
            />
        </div>
    </div>
</div>

<table id="reportsTable" class="table">
    <thead>
        <tr>
            <th>Owner</th>
            <th>ID</th>
            <th>Name</th>
            <th>Security Scope</th>
            <th>Status</th>
            <th>Primary Analyst</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var report in Model.Reports)
        {
            <tr data-status="@report.Status">
                <td>@report.Owner</td>
                <td>@report.ID</td>
                <td>@report.Name</td>
                <td>@report.SecurityScope</td>
                <td class="status-cell @report.Status.ToLower()">@report.Status</td>
                <td>@report.PrimaryAnalyst</td>
            </tr>
        }
    </tbody>
</table>

<div id="reportCounter" class="mt-2 text-muted">
    Showing @Model.Reports.Count() of @Model.Reports.Count() reports
</div>