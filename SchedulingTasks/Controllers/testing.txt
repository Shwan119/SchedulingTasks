-- Step 1: Create temp table capturing ID, original Title, first numeric segment and cleaned Title
SELECT
  t.ID,
  t.Title AS OriginalTitle,
  -- Position of the first ' - ' followed by a digit
  NumPos = PATINDEX('% - [0-9]%', t.Title),
  -- Position of the next ' - ' after the number (or end of string)
  NextDelimiter = CASE
    WHEN PATINDEX('% - [0-9]%', t.Title) = 0 THEN NULL
    WHEN CHARINDEX(' - ', t.Title, PATINDEX('% - [0-9]%', t.Title) + 3) > 0
      THEN CHARINDEX(' - ', t.Title, PATINDEX('% - [0-9]%', t.Title) + 3)
    ELSE LEN(t.Title) + 1
  END,
  -- Extract just the digits
  ExtractedNumber = CASE
    WHEN PATINDEX('% - [0-9]%', t.Title) > 0 THEN
      SUBSTRING(
        t.Title,
        PATINDEX('% - [0-9]%', t.Title) + 3,
        CASE
          WHEN CHARINDEX(' - ', t.Title, PATINDEX('% - [0-9]%', t.Title) + 3) > 0
            THEN CHARINDEX(' - ', t.Title, PATINDEX('% - [0-9]%', t.Title) + 3)
          ELSE LEN(t.Title) + 1
        END
        - (PATINDEX('% - [0-9]%', t.Title) + 3)
      )
    ELSE NULL
  END,
  -- Build new Title: prefix + any suffix after the numeric block, trimming spaces
  NewTitle = CASE
    WHEN PATINDEX('% - [0-9]%', t.Title) = 0 THEN t.Title
    ELSE RTRIM(
      LEFT(t.Title, PATINDEX('% - [0-9]%', t.Title) - 1)
      +
      CASE
        WHEN CHARINDEX(' - ', t.Title, PATINDEX('% - [0-9]%', t.Title) + 3) > 0
        THEN ' - ' + LTRIM(
          SUBSTRING(
            t.Title,
            CHARINDEX(' - ', t.Title, PATINDEX('% - [0-9]%', t.Title) + 3) + 3,
            LEN(t.Title)
          )
        )
        ELSE ''
      END
    )
  END
INTO #TempTitleNumbers
FROM MyTable t
WHERE
  PATINDEX('% - [0-9]%', t.Title) > 0
  AND -- ensure the extracted segment is strictly digits
  SUBSTRING(
    t.Title,
    PATINDEX('% - [0-9]%', t.Title) + 3,
    CASE
      WHEN CHARINDEX(' - ', t.Title, PATINDEX('% - [0-9]%', t.Title) + 3) > 0
        THEN CHARINDEX(' - ', t.Title, PATINDEX('% - [0-9]%', t.Title) + 3)
      ELSE LEN(t.Title) + 1
    END
    - (PATINDEX('% - [0-9]%', t.Title) + 3)
  ) NOT LIKE '%[^0-9]%';

-- Step 2: Preview changes
SELECT ID, OriginalTitle, ExtractedNumber, NewTitle
FROM #TempTitleNumbers;

-- Step 3: Apply to main table
UPDATE m
SET
  m.ait     = tmp.ExtractedNumber,
  m.Title   = tmp.NewTitle
FROM MyTable m
JOIN #TempTitleNumbers tmp
  ON m.ID = tmp.ID;

-- Step 4: Clean up
DROP TABLE #TempTitleNumbers;
