<tr class="filter-row">
    <td>@Html.TextBoxFor(m => m.OwnerFilter, new { @class = "form-control column-filter", data_column = "0", placeholder = "Filter Owner" })</td>
    <td>@Html.TextBoxFor(m => m.IdFilter, new { @class = "form-control column-filter", data_column = "1", placeholder = "Filter ID" })</td>
    <td>@Html.TextBoxFor(m => m.NameFilter, new { @class = "form-control column-filter", data_column = "2", placeholder = "Filter Name" })</td>
    <td>@Html.TextBoxFor(m => m.ScopeFilter, new { @class = "form-control column-filter", data_column = "3", placeholder = "Filter Security Scope" })</td>
    <td>@Html.TextBoxFor(m => m.StatusFilter, new { @class = "form-control column-filter", data_column = "4", placeholder = "Filter Status" })</td>
    <td>@Html.TextBoxFor(m => m.AnalystFilter, new { @class = "form-control column-filter", data_column = "5", placeholder = "Filter Primary Analyst" })</td>
</tr>

$(document).ready(function() {
    // Handle filter checkbox changes for status
    $('#showAll, #filterActive, #filterPending, #filterRetired').on('change', function() {
        const $this = $(this);
        const thisId = $this.attr('id');
        
        // If "Show All" was just checked
        if (thisId === 'showAll') {
            if ($this.prop('checked')) {
                // Uncheck all specific filters when "Show All" is checked
                $('#filterActive, #filterPending, #filterRetired').prop('checked', false);
            } else {
                // If "Show All" was unchecked but no specific filters are checked,
                // keep "Show All" checked
                if (!$('#filterActive').prop('checked') && 
                    !$('#filterPending').prop('checked') && 
                    !$('#filterRetired').prop('checked')) {
                    $('#showAll').prop('checked', true);
                    return; // Exit early to prevent infinite loop
                }
            }
        } else {
            // A specific filter was clicked
            if ($this.prop('checked')) {
                // If any specific filter is checked, uncheck "Show All"
                $('#showAll').prop('checked', false);
            } else {
                // If this specific filter was unchecked, check if any other specific filters are still checked
                if (!$('#filterActive').prop('checked') && 
                    !$('#filterPending').prop('checked') && 
                    !$('#filterRetired').prop('checked')) {
                    // If no specific filters are checked, check "Show All"
                    $('#showAll').prop('checked', true);
                }
            }
        }
        
        // Now apply the filtering
        applyFilters();
    });
    
    // Handle keyup event for column filters
    $('.column-filter').on('keyup', function() {
        applyFilters();
    });
    
    function applyFilters() {
        const showAll = $('#showAll').prop('checked');
        const showActive = $('#filterActive').prop('checked');
        const showPending = $('#filterPending').prop('checked');
        const showRetired = $('#filterRetired').prop('checked');
        
        // Get column filter values
        const filterValues = [];
        $('.column-filter').each(function() {
            const columnIndex = $(this).data('column');
            filterValues[columnIndex] = $(this).val().toLowerCase();
        });
        
        // Iterate through each row for filtering
        $('#reportsTable tbody tr').each(function() {
            const $row = $(this);
            const status = $row.data('status');
            
            // Check status filter conditions
            let showByStatus = showAll || 
                (showActive && status === 'Active') || 
                (showPending && status === 'Pending') || 
                (showRetired && status === 'Retired');
            
            // If it passes status filter, check column filters
            if (showByStatus) {
                let showByColumn = true;
                
                // Check each column's filter value
                $row.find('td').each(function(index) {
                    const cellText = $(this).text().toLowerCase();
                    const filterValue = filterValues[index];
                    
                    // If filter has a value and it doesn't match the cell
                    if (filterValue && cellText.indexOf(filterValue) === -1) {
                        showByColumn = false;
                        return false; // Break the loop
                    }
                });
                
                // Show/hide based on combined filter results
                if (showByColumn) {
                    $row.show();
                } else {
                    $row.hide();
                }
            } else {
                $row.hide();
            }
        });
    }
    
    // Initialize filtering on page load
    applyFilters();
    
    // Add some basic styling for the filter inputs
    $('<style>')
        .prop('type', 'text/css')
        .html(`
            .filter-row td {
                padding: 5px;
            }
            #reportsTable th {
                white-space: nowrap;
                min-width: 100px;
            }
        `)
        .appendTo('head');
});